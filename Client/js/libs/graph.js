// Generated by CoffeeScript 1.9.3
(function() {
  var $, Chart, Graph, log, trim_push;

  log = console.log;

  $ = require("jquery");

  Chart = require('chart.js');

  trim_push = function(array, value, size) {
    while (array.length >= size) {
      array.shift();
    }
    return array.push(value);
  };

  Graph = (function() {
    function Graph(id, key1, color, client1) {
      var stats;
      this.id = id;
      this.key = key1;
      this.color = color;
      this.client = client1;
      this.init_dom_element();
      stats = {
        type: 'line',
        data: {
          labels: ['3.5', '3.0', '2.5', '2.0', '1.5', '1.0', '0.5'],
          datasets: [
            {
              label: this.id,
              data: [0, 0, 0, 0, 0, 0, 0],
              backgroundColor: this.color
            }
          ]
        },
        options: {
          responsive: false
        }
      };
      this.chart = new Chart( this.ctx, stats );;
      this.chart_data = this.chart.data.datasets[0].data;
      this.init_update_iteration(500);
    }

    Graph.prototype.init_dom_element = function() {
      this.element = document.createElement('canvas');
      $(this.element).attr("id", this.id).attr("width", "500px").attr("height", "500px").appendTo('.graphs');
      return this.ctx = this.element.getContext('2d');
    };

    Graph.prototype.init_update_iteration = function(time) {
      var chart, client, key;
      chart = this.chart;
      key = this.key;
      client = this.client;
      return window.setInterval(function() {
        return client.getAsync(key).then(function(res) {
          trim_push(chart.data.datasets[0].data, res, 7);
          return chart.update();
        });
      }, time);
    };

    return Graph;

  })();

  exports.Graph = Graph;

}).call(this);
